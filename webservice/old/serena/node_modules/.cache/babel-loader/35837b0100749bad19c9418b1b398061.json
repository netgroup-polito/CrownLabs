{"ast":null,"code":"/*!\n * algorithms/helpers.js - Internal functions and fields used in Cryptographic\n * Algorithms\n *\n * Copyright (c) 2015 Cisco Systems, Inc.  See LICENSE file.\n */\n\"use strict\";\n\nif (typeof Promise === \"undefined\") {\n  require(\"es6-promise\").polyfill();\n} // ###\n\n\nexports.int32ToBuffer = function (v, b) {\n  b = b || Buffer.alloc(4);\n  b[0] = v >>> 24 & 0xff;\n  b[1] = v >>> 16 & 0xff;\n  b[2] = v >>> 8 & 0xff;\n  b[3] = v & 0xff;\n  return b;\n};\n\nvar MAX_INT32 = Math.pow(2, 32);\n\nexports.int64ToBuffer = function (v, b) {\n  b = b || Buffer.alloc(8);\n  var hi = Math.floor(v / MAX_INT32),\n      lo = v % MAX_INT32;\n  hi = exports.int32ToBuffer(hi);\n  lo = exports.int32ToBuffer(lo);\n  b = Buffer.concat([hi, lo]);\n  return b;\n}; // ### crypto and DOMException in browsers ###\n\n/* global crypto:false, DOMException:false */\n\n\nfunction getCryptoSubtle() {\n  if (\"undefined\" !== typeof crypto) {\n    if (\"undefined\" !== typeof crypto.subtle) {\n      return crypto.subtle;\n    }\n  }\n\n  return undefined;\n}\n\nfunction getCryptoNodeJS() {\n  var crypto;\n\n  try {\n    crypto = require(\"crypto\");\n  } catch (err) {\n    return undefined;\n  }\n\n  if (!Object.keys(crypto).length) {\n    // treat empty the same as missing\n    return undefined;\n  }\n\n  return crypto;\n}\n\nvar supported = {};\nObject.defineProperty(exports, \"subtleCrypto\", {\n  get: function () {\n    var result;\n\n    if (\"subtleCrypto\" in supported) {\n      result = supported.subtleCrypto;\n    } else {\n      result = supported.subtleCrypto = getCryptoSubtle();\n    }\n\n    return result;\n  },\n  enumerable: true\n});\nObject.defineProperty(exports, \"nodeCrypto\", {\n  get: function () {\n    var result;\n\n    if (\"nodeCrypto\" in supported) {\n      result = supported.nodeCrypto;\n    } else {\n      result = supported.nodeCrypto = getCryptoNodeJS();\n    }\n\n    return result;\n  },\n  enumerable: true\n});\n\nexports.setupFallback = function (nodejs, webcrypto, fallback) {\n  var impl;\n\n  if (nodejs && exports.nodeCrypto) {\n    impl = function main() {\n      var args = arguments,\n          promise;\n\n      function check(err) {\n        if (0 === err.message.indexOf(\"unsupported algorithm:\")) {\n          impl = fallback;\n          return impl.apply(null, args);\n        }\n\n        return Promise.reject(err);\n      }\n\n      try {\n        promise = Promise.resolve(nodejs.apply(null, args));\n      } catch (err) {\n        promise = check(err);\n      }\n\n      return promise;\n    };\n  } else if (webcrypto && exports.subtleCrypto) {\n    impl = function main() {\n      var args = arguments,\n          promise;\n\n      function check(err) {\n        if (err.code === DOMException.NOT_SUPPORTED_ERR || // Firefox rejects some operations erroneously complaining about inputs\n        err.message === \"Only ArrayBuffer and ArrayBufferView objects can be passed as CryptoOperationData\" || // MS Edge rejects with not an Error\n        !(err instanceof Error)) {\n          // not actually supported -- always use fallback\n          impl = fallback;\n          return impl.apply(null, args);\n        }\n\n        return Promise.reject(err);\n      }\n\n      try {\n        promise = webcrypto.apply(null, args);\n        promise = promise.catch(check);\n      } catch (err) {\n        promise = check(err);\n      }\n\n      return promise;\n    };\n  } else {\n    impl = fallback;\n  }\n\n  return impl;\n};","map":{"version":3,"sources":["/home/s41m0n/Documents/University/Turin/YearII/CrownLabs/frontend/node_modules/node-jose/lib/algorithms/helpers.js"],"names":["Promise","require","polyfill","exports","int32ToBuffer","v","b","Buffer","alloc","MAX_INT32","Math","pow","int64ToBuffer","hi","floor","lo","concat","getCryptoSubtle","crypto","subtle","undefined","getCryptoNodeJS","err","Object","keys","length","supported","defineProperty","get","result","subtleCrypto","enumerable","nodeCrypto","setupFallback","nodejs","webcrypto","fallback","impl","main","args","arguments","promise","check","message","indexOf","apply","reject","resolve","code","DOMException","NOT_SUPPORTED_ERR","Error","catch"],"mappings":"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","sourcesContent":["/*!\n * algorithms/helpers.js - Internal functions and fields used in Cryptographic\n * Algorithms\n *\n * Copyright (c) 2015 Cisco Systems, Inc.  See LICENSE file.\n */\n\"use strict\";\n\nif (typeof Promise === \"undefined\") {\n  require(\"es6-promise\").polyfill();\n}\n\n// ###\nexports.int32ToBuffer = function(v, b) {\n  b = b || Buffer.alloc(4);\n  b[0] = (v >>> 24) & 0xff;\n  b[1] = (v >>> 16) & 0xff;\n  b[2] = (v >>> 8) & 0xff;\n  b[3] = v & 0xff;\n  return b;\n};\n\nvar MAX_INT32 = Math.pow(2, 32);\nexports.int64ToBuffer = function(v, b) {\n  b = b || Buffer.alloc(8);\n  var hi = Math.floor(v / MAX_INT32),\n      lo = v % MAX_INT32;\n  hi = exports.int32ToBuffer(hi);\n  lo = exports.int32ToBuffer(lo);\n  b = Buffer.concat([hi, lo]);\n  return b;\n};\n\n// ### crypto and DOMException in browsers ###\n/* global crypto:false, DOMException:false */\n\nfunction getCryptoSubtle() {\n  if (\"undefined\" !== typeof crypto) {\n    if (\"undefined\" !== typeof crypto.subtle) {\n      return crypto.subtle;\n    }\n  }\n\n  return undefined;\n}\nfunction getCryptoNodeJS() {\n  var crypto;\n  try {\n    crypto = require(\"crypto\");\n  } catch (err) {\n    return undefined;\n  }\n\n  if (!Object.keys(crypto).length) {\n    // treat empty the same as missing\n    return undefined;\n  }\n\n  return crypto;\n}\n\nvar supported = {};\nObject.defineProperty(exports, \"subtleCrypto\", {\n  get: function() {\n    var result;\n\n    if (\"subtleCrypto\" in supported) {\n      result = supported.subtleCrypto;\n    } else {\n      result = supported.subtleCrypto = getCryptoSubtle();\n    }\n\n    return result;\n  },\n  enumerable: true\n});\nObject.defineProperty(exports, \"nodeCrypto\", {\n  get: function() {\n    var result;\n\n    if (\"nodeCrypto\" in supported) {\n      result = supported.nodeCrypto;\n    } else {\n      result = supported.nodeCrypto = getCryptoNodeJS();\n    }\n\n    return result;\n  },\n  enumerable: true\n});\n\nexports.setupFallback = function(nodejs, webcrypto, fallback) {\n  var impl;\n\n  if (nodejs && exports.nodeCrypto) {\n    impl = function main() {\n      var args = arguments,\n          promise;\n\n      function check(err) {\n        if (0 === err.message.indexOf(\"unsupported algorithm:\")) {\n          impl = fallback;\n          return impl.apply(null, args);\n        }\n\n        return Promise.reject(err);\n      }\n\n      try {\n        promise = Promise.resolve(nodejs.apply(null, args));\n      } catch(err) {\n        promise = check(err);\n      }\n\n      return promise;\n    };\n  } else if (webcrypto && exports.subtleCrypto) {\n    impl = function main() {\n      var args = arguments,\n         promise;\n\n      function check(err) {\n        if (err.code === DOMException.NOT_SUPPORTED_ERR ||\n            // Firefox rejects some operations erroneously complaining about inputs\n            err.message === \"Only ArrayBuffer and ArrayBufferView objects can be passed as CryptoOperationData\" ||\n            // MS Edge rejects with not an Error\n            !(err instanceof Error)) {\n          // not actually supported -- always use fallback\n          impl = fallback;\n          return impl.apply(null, args);\n        }\n\n       return Promise.reject(err);\n      }\n\n      try {\n        promise = webcrypto.apply(null, args);\n        promise = promise.catch(check);\n      } catch(err) {\n        promise = check(err);\n      }\n\n      return promise;\n    };\n  } else {\n    impl = fallback;\n  }\n\n  return impl;\n};\n"]},"metadata":{},"sourceType":"script"}