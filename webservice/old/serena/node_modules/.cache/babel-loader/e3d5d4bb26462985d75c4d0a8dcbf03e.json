{"ast":null,"code":"/*!\n * jwk/octkey.js - Symmetric Octet Key Representation\n *\n * Copyright (c) 2015 Cisco Systems, Inc. See LICENSE file.\n */\n\"use strict\";\n\nvar util = require(\"../util\");\n\nvar JWK = {\n  BaseKey: require(\"./basekey.js\"),\n  helpers: require(\"./helpers.js\")\n};\nvar SIG_ALGS = [\"HS256\", \"HS384\", \"HS512\"];\nvar ENC_ALGS = [\"A128GCM\", \"A192GCM\", \"A256GCM\", \"A128CBC-HS256\", \"A192CBC-HS384\", \"A256CBC-HS512\", \"A128CBC+HS256\", \"A192CBC+HS384\", \"A256CBC+HS512\"];\nvar WRAP_ALGS = [\"A128KW\", \"A192KW\", \"A256KW\", \"A128GCMKW\", \"A192GCMKW\", \"A256GCMKW\", \"PBES2-HS256+A128KW\", \"PBES2-HS384+A192KW\", \"PBES2-HS512+A256KW\", \"dir\"];\n\nfunction adjustDecryptProps(alg, props) {\n  if (\"iv\" in props) {\n    props.iv = Buffer.isBuffer(props.iv) ? props.iv : util.base64url.decode(props.iv || \"\");\n  }\n\n  if (\"adata\" in props) {\n    props.adata = Buffer.isBuffer(props.adata) ? props.adata : Buffer.from(props.adata || \"\", \"utf8\");\n  }\n\n  if (\"mac\" in props) {\n    props.mac = Buffer.isBuffer(props.mac) ? props.mac : util.base64url.decode(props.mac || \"\");\n  }\n\n  if (\"tag\" in props) {\n    props.tag = Buffer.isBuffer(props.tag) ? props.tag : util.base64url.decode(props.tag || \"\");\n  }\n\n  return props;\n}\n\nfunction adjustEncryptProps(alg, props) {\n  if (\"iv\" in props) {\n    props.iv = Buffer.isBuffer(props.iv) ? props.iv : util.base64url.decode(props.iv || \"\");\n  }\n\n  if (\"adata\" in props) {\n    props.adata = Buffer.isBuffer(props.adata) ? props.adata : Buffer.from(props.adata || \"\", \"utf8\");\n  }\n\n  return props;\n}\n\nvar JWKOctetCfg = {\n  publicKey: function (props) {\n    var fields = JWK.helpers.COMMON_PROPS.concat([]);\n    var pk;\n    pk = JWK.helpers.unpackProps(props, fields);\n    return pk;\n  },\n  privateKey: function (props) {\n    var fields = JWK.helpers.COMMON_PROPS.concat([{\n      name: \"k\",\n      type: \"binary\"\n    }]);\n    var pk;\n    pk = JWK.helpers.unpackProps(props, fields);\n\n    if (pk && pk.k) {\n      pk.length = pk.k.length * 8;\n    } else {\n      pk = undefined;\n    }\n\n    return pk;\n  },\n  thumbprint: function (json) {\n    if (json.private) {\n      json = json.private;\n    }\n\n    var fields;\n    fields = {\n      k: json.k || \"\",\n      kty: \"oct\"\n    };\n    return fields;\n  },\n  algorithms: function (keys, mode) {\n    var len = keys.private && keys.private.k.length * 8;\n    var mins = [256, 384, 512];\n\n    if (!len) {\n      return [];\n    }\n\n    switch (mode) {\n      case \"encrypt\":\n      case \"decrypt\":\n        return ENC_ALGS.filter(function (a) {\n          return a === \"A\" + len / 2 + \"CBC-HS\" + len || a === \"A\" + len / 2 + \"CBC+HS\" + len || a === \"A\" + len + \"GCM\";\n        });\n\n      case \"sign\":\n      case \"verify\":\n        // TODO: allow for HS{less-than-keysize}\n        return SIG_ALGS.filter(function (a) {\n          var result = false;\n          mins.forEach(function (m) {\n            if (m > len) {\n              return;\n            }\n\n            result = result | a === \"HS\" + m;\n          });\n          return result;\n        });\n\n      case \"wrap\":\n      case \"unwrap\":\n        return WRAP_ALGS.filter(function (a) {\n          return a === \"A\" + len + \"KW\" || a === \"A\" + len + \"GCMKW\" || a.indexOf(\"PBES2-\") === 0 || a === \"dir\";\n        });\n    }\n\n    return [];\n  },\n  encryptKey: function (alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  encryptProps: adjustEncryptProps,\n  decryptKey: function (alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  decryptProps: adjustDecryptProps,\n  wrapKey: function (alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  wrapProps: adjustEncryptProps,\n  unwrapKey: function (alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  unwrapProps: adjustDecryptProps,\n  signKey: function (alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  verifyKey: function (alg, keys) {\n    return keys.private && keys.private.k;\n  }\n}; // Factory\n\nvar JWKOctetFactory = {\n  kty: \"oct\",\n  prepare: function (props) {\n    // TODO: validate key properties\n    var cfg = JWKOctetCfg;\n    var p = Promise.resolve(props);\n    p = p.then(function (json) {\n      return JWK.helpers.thumbprint(cfg, json);\n    });\n    p = p.then(function (hash) {\n      var prints = {};\n      prints[JWK.helpers.INTERNALS.THUMBPRINT_HASH] = hash;\n      props[JWK.helpers.INTERNALS.THUMBPRINT_KEY] = prints;\n      return cfg;\n    });\n    return p;\n  },\n  generate: function (size) {\n    // TODO: validate key sizes\n    var key = util.randomBytes(size / 8);\n    return Promise.resolve({\n      k: key\n    });\n  }\n}; // public API\n\nmodule.exports = Object.freeze({\n  config: JWKOctetCfg,\n  factory: JWKOctetFactory\n}); // registration\n\n(function (REGISTRY) {\n  REGISTRY.register(JWKOctetFactory);\n})(require(\"./keystore\").registry);","map":{"version":3,"sources":["/home/s41m0n/Documents/University/Turin/YearII/CrownLabs/frontend/node_modules/node-jose/lib/jwk/octkey.js"],"names":["util","require","JWK","BaseKey","helpers","SIG_ALGS","ENC_ALGS","WRAP_ALGS","adjustDecryptProps","alg","props","iv","Buffer","isBuffer","base64url","decode","adata","from","mac","tag","adjustEncryptProps","JWKOctetCfg","publicKey","fields","COMMON_PROPS","concat","pk","unpackProps","privateKey","name","type","k","length","undefined","thumbprint","json","private","kty","algorithms","keys","mode","len","mins","filter","a","result","forEach","m","indexOf","encryptKey","encryptProps","decryptKey","decryptProps","wrapKey","wrapProps","unwrapKey","unwrapProps","signKey","verifyKey","JWKOctetFactory","prepare","cfg","p","Promise","resolve","then","hash","prints","INTERNALS","THUMBPRINT_HASH","THUMBPRINT_KEY","generate","size","key","randomBytes","module","exports","Object","freeze","config","factory","REGISTRY","register","registry"],"mappings":"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","sourcesContent":["/*!\n * jwk/octkey.js - Symmetric Octet Key Representation\n *\n * Copyright (c) 2015 Cisco Systems, Inc. See LICENSE file.\n */\n\"use strict\";\n\nvar util = require(\"../util\");\n\nvar JWK = {\n  BaseKey: require(\"./basekey.js\"),\n  helpers: require(\"./helpers.js\")\n};\n\nvar SIG_ALGS = [\n  \"HS256\",\n  \"HS384\",\n  \"HS512\"\n];\nvar ENC_ALGS = [\n  \"A128GCM\",\n  \"A192GCM\",\n  \"A256GCM\",\n  \"A128CBC-HS256\",\n  \"A192CBC-HS384\",\n  \"A256CBC-HS512\",\n  \"A128CBC+HS256\",\n  \"A192CBC+HS384\",\n  \"A256CBC+HS512\"\n];\nvar WRAP_ALGS = [\n  \"A128KW\",\n  \"A192KW\",\n  \"A256KW\",\n  \"A128GCMKW\",\n  \"A192GCMKW\",\n  \"A256GCMKW\",\n  \"PBES2-HS256+A128KW\",\n  \"PBES2-HS384+A192KW\",\n  \"PBES2-HS512+A256KW\",\n  \"dir\"\n];\n\nfunction adjustDecryptProps(alg, props) {\n  if (\"iv\" in props) {\n    props.iv = Buffer.isBuffer(props.iv) ?\n               props.iv :\n               util.base64url.decode(props.iv || \"\");\n  }\n  if (\"adata\" in props) {\n    props.adata = Buffer.isBuffer(props.adata) ?\n                  props.adata :\n                  Buffer.from(props.adata || \"\", \"utf8\");\n  }\n  if (\"mac\" in props) {\n    props.mac = Buffer.isBuffer(props.mac) ?\n                props.mac :\n                util.base64url.decode(props.mac || \"\");\n  }\n  if (\"tag\" in props) {\n    props.tag = Buffer.isBuffer(props.tag) ?\n                props.tag :\n                util.base64url.decode(props.tag || \"\");\n  }\n\n  return props;\n}\nfunction adjustEncryptProps(alg, props) {\n  if (\"iv\" in props) {\n    props.iv = Buffer.isBuffer(props.iv) ?\n               props.iv :\n               util.base64url.decode(props.iv || \"\");\n  }\n  if (\"adata\" in props) {\n    props.adata = Buffer.isBuffer(props.adata) ?\n                  props.adata :\n                  Buffer.from(props.adata || \"\", \"utf8\");\n  }\n\n  return props;\n}\n\nvar JWKOctetCfg = {\n  publicKey: function(props) {\n    var fields = JWK.helpers.COMMON_PROPS.concat([\n    ]);\n\n    var pk;\n    pk = JWK.helpers.unpackProps(props, fields);\n\n    return pk;\n  },\n  privateKey: function(props) {\n    var fields = JWK.helpers.COMMON_PROPS.concat([\n      {name: \"k\", type: \"binary\"}\n    ]);\n\n    var pk;\n    pk = JWK.helpers.unpackProps(props, fields);\n    if (pk && pk.k) {\n      pk.length = pk.k.length * 8;\n    } else {\n      pk = undefined;\n    }\n\n    return pk;\n  },\n\n  thumbprint: function(json) {\n    if (json.private) {\n      json = json.private;\n    }\n    var fields;\n    fields = {\n      k: json.k || \"\",\n      kty: \"oct\"\n    };\n    return fields;\n  },\n  algorithms: function(keys, mode) {\n    var len = keys.private && (keys.private.k.length * 8);\n    var mins = [256, 384, 512];\n\n    if (!len) {\n      return [];\n    }\n    switch (mode) {\n      case \"encrypt\":\n      case \"decrypt\":\n        return ENC_ALGS.filter(function(a) {\n          return (a === (\"A\" + (len / 2) + \"CBC-HS\" + len)) ||\n                 (a === (\"A\" + (len / 2) + \"CBC+HS\" + len)) ||\n                 (a === (\"A\" + len + \"GCM\"));\n        });\n      case \"sign\":\n      case \"verify\":\n        // TODO: allow for HS{less-than-keysize}\n        return SIG_ALGS.filter(function(a) {\n          var result = false;\n          mins.forEach(function(m) {\n            if (m > len) { return; }\n            result = result | (a === (\"HS\" + m));\n          });\n          return result;\n        });\n      case \"wrap\":\n      case \"unwrap\":\n        return WRAP_ALGS.filter(function(a) {\n          return (a === (\"A\" + len + \"KW\")) ||\n                 (a === (\"A\" + len + \"GCMKW\")) ||\n                 (a.indexOf(\"PBES2-\") === 0) ||\n                 (a === \"dir\");\n        });\n    }\n\n    return [];\n  },\n  encryptKey: function(alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  encryptProps: adjustEncryptProps,\n\n  decryptKey: function(alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  decryptProps: adjustDecryptProps,\n\n  wrapKey: function(alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  wrapProps: adjustEncryptProps,\n\n  unwrapKey: function(alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  unwrapProps: adjustDecryptProps,\n\n  signKey: function(alg, keys) {\n    return keys.private && keys.private.k;\n  },\n  verifyKey: function(alg, keys) {\n    return keys.private && keys.private.k;\n  }\n};\n\n// Factory\nvar JWKOctetFactory = {\n  kty: \"oct\",\n  prepare: function(props) {\n    // TODO: validate key properties\n    var cfg = JWKOctetCfg;\n    var p = Promise.resolve(props);\n    p = p.then(function(json) {\n      return JWK.helpers.thumbprint(cfg, json);\n    });\n    p = p.then(function(hash) {\n      var prints = {};\n      prints[JWK.helpers.INTERNALS.THUMBPRINT_HASH] = hash;\n      props[JWK.helpers.INTERNALS.THUMBPRINT_KEY] = prints;\n      return cfg;\n    });\n    return p;\n  },\n  generate: function(size) {\n    // TODO: validate key sizes\n    var key = util.randomBytes(size / 8);\n\n    return Promise.resolve({\n      k: key\n    });\n  }\n};\n\n// public API\nmodule.exports = Object.freeze({\n  config: JWKOctetCfg,\n  factory: JWKOctetFactory\n});\n\n// registration\n(function(REGISTRY) {\n  REGISTRY.register(JWKOctetFactory);\n})(require(\"./keystore\").registry);\n"]},"metadata":{},"sourceType":"script"}