{"ast":null,"code":"var inherits = require('inherits');\n\nvar Buffer = require('buffer').Buffer;\n\nvar asn1 = require('../../asn1');\n\nvar base = asn1.base; // Import DER constants\n\nvar der = asn1.constants.der;\n\nfunction DEREncoder(entity) {\n  this.enc = 'der';\n  this.name = entity.name;\n  this.entity = entity; // Construct base tree\n\n  this.tree = new DERNode();\n\n  this.tree._init(entity.body);\n}\n\n;\nmodule.exports = DEREncoder;\n\nDEREncoder.prototype.encode = function encode(data, reporter) {\n  return this.tree._encode(data, reporter).join();\n}; // Tree methods\n\n\nfunction DERNode(parent) {\n  base.Node.call(this, 'der', parent);\n}\n\ninherits(DERNode, base.Node);\n\nDERNode.prototype._encodeComposite = function encodeComposite(tag, primitive, cls, content) {\n  var encodedTag = encodeTag(tag, primitive, cls, this.reporter); // Short form\n\n  if (content.length < 0x80) {\n    var header = new Buffer(2);\n    header[0] = encodedTag;\n    header[1] = content.length;\n    return this._createEncoderBuffer([header, content]);\n  } // Long form\n  // Count octets required to store length\n\n\n  var lenOctets = 1;\n\n  for (var i = content.length; i >= 0x100; i >>= 8) lenOctets++;\n\n  var header = new Buffer(1 + 1 + lenOctets);\n  header[0] = encodedTag;\n  header[1] = 0x80 | lenOctets;\n\n  for (var i = 1 + lenOctets, j = content.length; j > 0; i--, j >>= 8) header[i] = j & 0xff;\n\n  return this._createEncoderBuffer([header, content]);\n};\n\nDERNode.prototype._encodeStr = function encodeStr(str, tag) {\n  if (tag === 'bitstr') {\n    return this._createEncoderBuffer([str.unused | 0, str.data]);\n  } else if (tag === 'bmpstr') {\n    var buf = new Buffer(str.length * 2);\n\n    for (var i = 0; i < str.length; i++) {\n      buf.writeUInt16BE(str.charCodeAt(i), i * 2);\n    }\n\n    return this._createEncoderBuffer(buf);\n  } else if (tag === 'numstr') {\n    if (!this._isNumstr(str)) {\n      return this.reporter.error('Encoding of string type: numstr supports ' + 'only digits and space');\n    }\n\n    return this._createEncoderBuffer(str);\n  } else if (tag === 'printstr') {\n    if (!this._isPrintstr(str)) {\n      return this.reporter.error('Encoding of string type: printstr supports ' + 'only latin upper and lower case letters, ' + 'digits, space, apostrophe, left and rigth ' + 'parenthesis, plus sign, comma, hyphen, ' + 'dot, slash, colon, equal sign, ' + 'question mark');\n    }\n\n    return this._createEncoderBuffer(str);\n  } else if (/str$/.test(tag)) {\n    return this._createEncoderBuffer(str);\n  } else if (tag === 'objDesc') {\n    return this._createEncoderBuffer(str);\n  } else {\n    return this.reporter.error('Encoding of string type: ' + tag + ' unsupported');\n  }\n};\n\nDERNode.prototype._encodeObjid = function encodeObjid(id, values, relative) {\n  if (typeof id === 'string') {\n    if (!values) return this.reporter.error('string objid given, but no values map found');\n    if (!values.hasOwnProperty(id)) return this.reporter.error('objid not found in values map');\n    id = values[id].split(/[\\s\\.]+/g);\n\n    for (var i = 0; i < id.length; i++) id[i] |= 0;\n  } else if (Array.isArray(id)) {\n    id = id.slice();\n\n    for (var i = 0; i < id.length; i++) id[i] |= 0;\n  }\n\n  if (!Array.isArray(id)) {\n    return this.reporter.error('objid() should be either array or string, ' + 'got: ' + JSON.stringify(id));\n  }\n\n  if (!relative) {\n    if (id[1] >= 40) return this.reporter.error('Second objid identifier OOB');\n    id.splice(0, 2, id[0] * 40 + id[1]);\n  } // Count number of octets\n\n\n  var size = 0;\n\n  for (var i = 0; i < id.length; i++) {\n    var ident = id[i];\n\n    for (size++; ident >= 0x80; ident >>= 7) size++;\n  }\n\n  var objid = new Buffer(size);\n  var offset = objid.length - 1;\n\n  for (var i = id.length - 1; i >= 0; i--) {\n    var ident = id[i];\n    objid[offset--] = ident & 0x7f;\n\n    while ((ident >>= 7) > 0) objid[offset--] = 0x80 | ident & 0x7f;\n  }\n\n  return this._createEncoderBuffer(objid);\n};\n\nfunction two(num) {\n  if (num < 10) return '0' + num;else return num;\n}\n\nDERNode.prototype._encodeTime = function encodeTime(time, tag) {\n  var str;\n  var date = new Date(time);\n\n  if (tag === 'gentime') {\n    str = [two(date.getFullYear()), two(date.getUTCMonth() + 1), two(date.getUTCDate()), two(date.getUTCHours()), two(date.getUTCMinutes()), two(date.getUTCSeconds()), 'Z'].join('');\n  } else if (tag === 'utctime') {\n    str = [two(date.getFullYear() % 100), two(date.getUTCMonth() + 1), two(date.getUTCDate()), two(date.getUTCHours()), two(date.getUTCMinutes()), two(date.getUTCSeconds()), 'Z'].join('');\n  } else {\n    this.reporter.error('Encoding ' + tag + ' time is not supported yet');\n  }\n\n  return this._encodeStr(str, 'octstr');\n};\n\nDERNode.prototype._encodeNull = function encodeNull() {\n  return this._createEncoderBuffer('');\n};\n\nDERNode.prototype._encodeInt = function encodeInt(num, values) {\n  if (typeof num === 'string') {\n    if (!values) return this.reporter.error('String int or enum given, but no values map');\n\n    if (!values.hasOwnProperty(num)) {\n      return this.reporter.error('Values map doesn\\'t contain: ' + JSON.stringify(num));\n    }\n\n    num = values[num];\n  } // Bignum, assume big endian\n\n\n  if (typeof num !== 'number' && !Buffer.isBuffer(num)) {\n    var numArray = num.toArray();\n\n    if (!num.sign && numArray[0] & 0x80) {\n      numArray.unshift(0);\n    }\n\n    num = new Buffer(numArray);\n  }\n\n  if (Buffer.isBuffer(num)) {\n    var size = num.length;\n    if (num.length === 0) size++;\n    var out = new Buffer(size);\n    num.copy(out);\n    if (num.length === 0) out[0] = 0;\n    return this._createEncoderBuffer(out);\n  }\n\n  if (num < 0x80) return this._createEncoderBuffer(num);\n  if (num < 0x100) return this._createEncoderBuffer([0, num]);\n  var size = 1;\n\n  for (var i = num; i >= 0x100; i >>= 8) size++;\n\n  var out = new Array(size);\n\n  for (var i = out.length - 1; i >= 0; i--) {\n    out[i] = num & 0xff;\n    num >>= 8;\n  }\n\n  if (out[0] & 0x80) {\n    out.unshift(0);\n  }\n\n  return this._createEncoderBuffer(new Buffer(out));\n};\n\nDERNode.prototype._encodeBool = function encodeBool(value) {\n  return this._createEncoderBuffer(value ? 0xff : 0);\n};\n\nDERNode.prototype._use = function use(entity, obj) {\n  if (typeof entity === 'function') entity = entity(obj);\n  return entity._getEncoder('der').tree;\n};\n\nDERNode.prototype._skipDefault = function skipDefault(dataBuffer, reporter, parent) {\n  var state = this._baseState;\n  var i;\n  if (state['default'] === null) return false;\n  var data = dataBuffer.join();\n  if (state.defaultBuffer === undefined) state.defaultBuffer = this._encodeValue(state['default'], reporter, parent).join();\n  if (data.length !== state.defaultBuffer.length) return false;\n\n  for (i = 0; i < data.length; i++) if (data[i] !== state.defaultBuffer[i]) return false;\n\n  return true;\n}; // Utility methods\n\n\nfunction encodeTag(tag, primitive, cls, reporter) {\n  var res;\n  if (tag === 'seqof') tag = 'seq';else if (tag === 'setof') tag = 'set';\n  if (der.tagByName.hasOwnProperty(tag)) res = der.tagByName[tag];else if (typeof tag === 'number' && (tag | 0) === tag) res = tag;else return reporter.error('Unknown tag: ' + tag);\n  if (res >= 0x1f) return reporter.error('Multi-octet tag encoding unsupported');\n  if (!primitive) res |= 0x20;\n  res |= der.tagClassByName[cls || 'universal'] << 6;\n  return res;\n}","map":{"version":3,"sources":["/home/s41m0n/Documents/University/Turin/YearII/CrownLabs/frontend/node_modules/asn1.js/lib/asn1/encoders/der.js"],"names":["inherits","require","Buffer","asn1","base","der","constants","DEREncoder","entity","enc","name","tree","DERNode","_init","body","module","exports","prototype","encode","data","reporter","_encode","join","parent","Node","call","_encodeComposite","encodeComposite","tag","primitive","cls","content","encodedTag","encodeTag","length","header","_createEncoderBuffer","lenOctets","i","j","_encodeStr","encodeStr","str","unused","buf","writeUInt16BE","charCodeAt","_isNumstr","error","_isPrintstr","test","_encodeObjid","encodeObjid","id","values","relative","hasOwnProperty","split","Array","isArray","slice","JSON","stringify","splice","size","ident","objid","offset","two","num","_encodeTime","encodeTime","time","date","Date","getFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","_encodeNull","encodeNull","_encodeInt","encodeInt","isBuffer","numArray","toArray","sign","unshift","out","copy","_encodeBool","encodeBool","value","_use","use","obj","_getEncoder","_skipDefault","skipDefault","dataBuffer","state","_baseState","defaultBuffer","undefined","_encodeValue","res","tagByName","tagClassByName"],"mappings":"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","sourcesContent":["var inherits = require('inherits');\nvar Buffer = require('buffer').Buffer;\n\nvar asn1 = require('../../asn1');\nvar base = asn1.base;\n\n// Import DER constants\nvar der = asn1.constants.der;\n\nfunction DEREncoder(entity) {\n  this.enc = 'der';\n  this.name = entity.name;\n  this.entity = entity;\n\n  // Construct base tree\n  this.tree = new DERNode();\n  this.tree._init(entity.body);\n};\nmodule.exports = DEREncoder;\n\nDEREncoder.prototype.encode = function encode(data, reporter) {\n  return this.tree._encode(data, reporter).join();\n};\n\n// Tree methods\n\nfunction DERNode(parent) {\n  base.Node.call(this, 'der', parent);\n}\ninherits(DERNode, base.Node);\n\nDERNode.prototype._encodeComposite = function encodeComposite(tag,\n                                                              primitive,\n                                                              cls,\n                                                              content) {\n  var encodedTag = encodeTag(tag, primitive, cls, this.reporter);\n\n  // Short form\n  if (content.length < 0x80) {\n    var header = new Buffer(2);\n    header[0] = encodedTag;\n    header[1] = content.length;\n    return this._createEncoderBuffer([ header, content ]);\n  }\n\n  // Long form\n  // Count octets required to store length\n  var lenOctets = 1;\n  for (var i = content.length; i >= 0x100; i >>= 8)\n    lenOctets++;\n\n  var header = new Buffer(1 + 1 + lenOctets);\n  header[0] = encodedTag;\n  header[1] = 0x80 | lenOctets;\n\n  for (var i = 1 + lenOctets, j = content.length; j > 0; i--, j >>= 8)\n    header[i] = j & 0xff;\n\n  return this._createEncoderBuffer([ header, content ]);\n};\n\nDERNode.prototype._encodeStr = function encodeStr(str, tag) {\n  if (tag === 'bitstr') {\n    return this._createEncoderBuffer([ str.unused | 0, str.data ]);\n  } else if (tag === 'bmpstr') {\n    var buf = new Buffer(str.length * 2);\n    for (var i = 0; i < str.length; i++) {\n      buf.writeUInt16BE(str.charCodeAt(i), i * 2);\n    }\n    return this._createEncoderBuffer(buf);\n  } else if (tag === 'numstr') {\n    if (!this._isNumstr(str)) {\n      return this.reporter.error('Encoding of string type: numstr supports ' +\n                                 'only digits and space');\n    }\n    return this._createEncoderBuffer(str);\n  } else if (tag === 'printstr') {\n    if (!this._isPrintstr(str)) {\n      return this.reporter.error('Encoding of string type: printstr supports ' +\n                                 'only latin upper and lower case letters, ' +\n                                 'digits, space, apostrophe, left and rigth ' +\n                                 'parenthesis, plus sign, comma, hyphen, ' +\n                                 'dot, slash, colon, equal sign, ' +\n                                 'question mark');\n    }\n    return this._createEncoderBuffer(str);\n  } else if (/str$/.test(tag)) {\n    return this._createEncoderBuffer(str);\n  } else if (tag === 'objDesc') {\n    return this._createEncoderBuffer(str);\n  } else {\n    return this.reporter.error('Encoding of string type: ' + tag +\n                               ' unsupported');\n  }\n};\n\nDERNode.prototype._encodeObjid = function encodeObjid(id, values, relative) {\n  if (typeof id === 'string') {\n    if (!values)\n      return this.reporter.error('string objid given, but no values map found');\n    if (!values.hasOwnProperty(id))\n      return this.reporter.error('objid not found in values map');\n    id = values[id].split(/[\\s\\.]+/g);\n    for (var i = 0; i < id.length; i++)\n      id[i] |= 0;\n  } else if (Array.isArray(id)) {\n    id = id.slice();\n    for (var i = 0; i < id.length; i++)\n      id[i] |= 0;\n  }\n\n  if (!Array.isArray(id)) {\n    return this.reporter.error('objid() should be either array or string, ' +\n                               'got: ' + JSON.stringify(id));\n  }\n\n  if (!relative) {\n    if (id[1] >= 40)\n      return this.reporter.error('Second objid identifier OOB');\n    id.splice(0, 2, id[0] * 40 + id[1]);\n  }\n\n  // Count number of octets\n  var size = 0;\n  for (var i = 0; i < id.length; i++) {\n    var ident = id[i];\n    for (size++; ident >= 0x80; ident >>= 7)\n      size++;\n  }\n\n  var objid = new Buffer(size);\n  var offset = objid.length - 1;\n  for (var i = id.length - 1; i >= 0; i--) {\n    var ident = id[i];\n    objid[offset--] = ident & 0x7f;\n    while ((ident >>= 7) > 0)\n      objid[offset--] = 0x80 | (ident & 0x7f);\n  }\n\n  return this._createEncoderBuffer(objid);\n};\n\nfunction two(num) {\n  if (num < 10)\n    return '0' + num;\n  else\n    return num;\n}\n\nDERNode.prototype._encodeTime = function encodeTime(time, tag) {\n  var str;\n  var date = new Date(time);\n\n  if (tag === 'gentime') {\n    str = [\n      two(date.getFullYear()),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('');\n  } else if (tag === 'utctime') {\n    str = [\n      two(date.getFullYear() % 100),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('');\n  } else {\n    this.reporter.error('Encoding ' + tag + ' time is not supported yet');\n  }\n\n  return this._encodeStr(str, 'octstr');\n};\n\nDERNode.prototype._encodeNull = function encodeNull() {\n  return this._createEncoderBuffer('');\n};\n\nDERNode.prototype._encodeInt = function encodeInt(num, values) {\n  if (typeof num === 'string') {\n    if (!values)\n      return this.reporter.error('String int or enum given, but no values map');\n    if (!values.hasOwnProperty(num)) {\n      return this.reporter.error('Values map doesn\\'t contain: ' +\n                                 JSON.stringify(num));\n    }\n    num = values[num];\n  }\n\n  // Bignum, assume big endian\n  if (typeof num !== 'number' && !Buffer.isBuffer(num)) {\n    var numArray = num.toArray();\n    if (!num.sign && numArray[0] & 0x80) {\n      numArray.unshift(0);\n    }\n    num = new Buffer(numArray);\n  }\n\n  if (Buffer.isBuffer(num)) {\n    var size = num.length;\n    if (num.length === 0)\n      size++;\n\n    var out = new Buffer(size);\n    num.copy(out);\n    if (num.length === 0)\n      out[0] = 0\n    return this._createEncoderBuffer(out);\n  }\n\n  if (num < 0x80)\n    return this._createEncoderBuffer(num);\n\n  if (num < 0x100)\n    return this._createEncoderBuffer([0, num]);\n\n  var size = 1;\n  for (var i = num; i >= 0x100; i >>= 8)\n    size++;\n\n  var out = new Array(size);\n  for (var i = out.length - 1; i >= 0; i--) {\n    out[i] = num & 0xff;\n    num >>= 8;\n  }\n  if(out[0] & 0x80) {\n    out.unshift(0);\n  }\n\n  return this._createEncoderBuffer(new Buffer(out));\n};\n\nDERNode.prototype._encodeBool = function encodeBool(value) {\n  return this._createEncoderBuffer(value ? 0xff : 0);\n};\n\nDERNode.prototype._use = function use(entity, obj) {\n  if (typeof entity === 'function')\n    entity = entity(obj);\n  return entity._getEncoder('der').tree;\n};\n\nDERNode.prototype._skipDefault = function skipDefault(dataBuffer, reporter, parent) {\n  var state = this._baseState;\n  var i;\n  if (state['default'] === null)\n    return false;\n\n  var data = dataBuffer.join();\n  if (state.defaultBuffer === undefined)\n    state.defaultBuffer = this._encodeValue(state['default'], reporter, parent).join();\n\n  if (data.length !== state.defaultBuffer.length)\n    return false;\n\n  for (i=0; i < data.length; i++)\n    if (data[i] !== state.defaultBuffer[i])\n      return false;\n\n  return true;\n};\n\n// Utility methods\n\nfunction encodeTag(tag, primitive, cls, reporter) {\n  var res;\n\n  if (tag === 'seqof')\n    tag = 'seq';\n  else if (tag === 'setof')\n    tag = 'set';\n\n  if (der.tagByName.hasOwnProperty(tag))\n    res = der.tagByName[tag];\n  else if (typeof tag === 'number' && (tag | 0) === tag)\n    res = tag;\n  else\n    return reporter.error('Unknown tag: ' + tag);\n\n  if (res >= 0x1f)\n    return reporter.error('Multi-octet tag encoding unsupported');\n\n  if (!primitive)\n    res |= 0x20;\n\n  res |= (der.tagClassByName[cls || 'universal'] << 6);\n\n  return res;\n}\n"]},"metadata":{},"sourceType":"script"}