{"ast":null,"code":"var common = require('./common');\n\nvar fs = require('fs');\n\nvar path = require('path');\n\nvar PERMS = function (base) {\n  return {\n    OTHER_EXEC: base.EXEC,\n    OTHER_WRITE: base.WRITE,\n    OTHER_READ: base.READ,\n    GROUP_EXEC: base.EXEC << 3,\n    GROUP_WRITE: base.WRITE << 3,\n    GROUP_READ: base.READ << 3,\n    OWNER_EXEC: base.EXEC << 6,\n    OWNER_WRITE: base.WRITE << 6,\n    OWNER_READ: base.READ << 6,\n    // Literal octal numbers are apparently not allowed in \"strict\" javascript.\n    STICKY: parseInt('01000', 8),\n    SETGID: parseInt('02000', 8),\n    SETUID: parseInt('04000', 8),\n    TYPE_MASK: parseInt('0770000', 8)\n  };\n}({\n  EXEC: 1,\n  WRITE: 2,\n  READ: 4\n});\n\ncommon.register('chmod', _chmod, {}); //@\n//@ ### chmod([options,] octal_mode || octal_string, file)\n//@ ### chmod([options,] symbolic_mode, file)\n//@\n//@ Available options:\n//@\n//@ + `-v`: output a diagnostic for every file processed//@\n//@ + `-c`: like verbose, but report only when a change is made//@\n//@ + `-R`: change files and directories recursively//@\n//@\n//@ Examples:\n//@\n//@ ```javascript\n//@ chmod(755, '/Users/brandon');\n//@ chmod('755', '/Users/brandon'); // same as above\n//@ chmod('u+x', '/Users/brandon');\n//@ chmod('-R', 'a-w', '/Users/brandon');\n//@ ```\n//@\n//@ Alters the permissions of a file or directory by either specifying the\n//@ absolute permissions in octal form or expressing the changes in symbols.\n//@ This command tries to mimic the POSIX behavior as much as possible.\n//@ Notable exceptions:\n//@\n//@ + In symbolic modes, `a-r` and `-r` are identical.  No consideration is\n//@   given to the `umask`.\n//@ + There is no \"quiet\" option, since default behavior is to run silent.\n\nfunction _chmod(options, mode, filePattern) {\n  if (!filePattern) {\n    if (options.length > 0 && options.charAt(0) === '-') {\n      // Special case where the specified file permissions started with - to subtract perms, which\n      // get picked up by the option parser as command flags.\n      // If we are down by one argument and options starts with -, shift everything over.\n      [].unshift.call(arguments, '');\n    } else {\n      common.error('You must specify a file.');\n    }\n  }\n\n  options = common.parseOptions(options, {\n    'R': 'recursive',\n    'c': 'changes',\n    'v': 'verbose'\n  });\n  filePattern = [].slice.call(arguments, 2);\n  var files; // TODO: replace this with a call to common.expand()\n\n  if (options.recursive) {\n    files = [];\n    filePattern.forEach(function addFile(expandedFile) {\n      var stat = common.statNoFollowLinks(expandedFile);\n\n      if (!stat.isSymbolicLink()) {\n        files.push(expandedFile);\n\n        if (stat.isDirectory()) {\n          // intentionally does not follow symlinks.\n          fs.readdirSync(expandedFile).forEach(function (child) {\n            addFile(expandedFile + '/' + child);\n          });\n        }\n      }\n    });\n  } else {\n    files = filePattern;\n  }\n\n  files.forEach(function innerChmod(file) {\n    file = path.resolve(file);\n\n    if (!fs.existsSync(file)) {\n      common.error('File not found: ' + file);\n    } // When recursing, don't follow symlinks.\n\n\n    if (options.recursive && common.statNoFollowLinks(file).isSymbolicLink()) {\n      return;\n    }\n\n    var stat = common.statFollowLinks(file);\n    var isDir = stat.isDirectory();\n    var perms = stat.mode;\n    var type = perms & PERMS.TYPE_MASK;\n    var newPerms = perms;\n\n    if (isNaN(parseInt(mode, 8))) {\n      // parse options\n      mode.split(',').forEach(function (symbolicMode) {\n        var pattern = /([ugoa]*)([=\\+-])([rwxXst]*)/i;\n        var matches = pattern.exec(symbolicMode);\n\n        if (matches) {\n          var applyTo = matches[1];\n          var operator = matches[2];\n          var change = matches[3];\n          var changeOwner = applyTo.indexOf('u') !== -1 || applyTo === 'a' || applyTo === '';\n          var changeGroup = applyTo.indexOf('g') !== -1 || applyTo === 'a' || applyTo === '';\n          var changeOther = applyTo.indexOf('o') !== -1 || applyTo === 'a' || applyTo === '';\n          var changeRead = change.indexOf('r') !== -1;\n          var changeWrite = change.indexOf('w') !== -1;\n          var changeExec = change.indexOf('x') !== -1;\n          var changeExecDir = change.indexOf('X') !== -1;\n          var changeSticky = change.indexOf('t') !== -1;\n          var changeSetuid = change.indexOf('s') !== -1;\n\n          if (changeExecDir && isDir) {\n            changeExec = true;\n          }\n\n          var mask = 0;\n\n          if (changeOwner) {\n            mask |= (changeRead ? PERMS.OWNER_READ : 0) + (changeWrite ? PERMS.OWNER_WRITE : 0) + (changeExec ? PERMS.OWNER_EXEC : 0) + (changeSetuid ? PERMS.SETUID : 0);\n          }\n\n          if (changeGroup) {\n            mask |= (changeRead ? PERMS.GROUP_READ : 0) + (changeWrite ? PERMS.GROUP_WRITE : 0) + (changeExec ? PERMS.GROUP_EXEC : 0) + (changeSetuid ? PERMS.SETGID : 0);\n          }\n\n          if (changeOther) {\n            mask |= (changeRead ? PERMS.OTHER_READ : 0) + (changeWrite ? PERMS.OTHER_WRITE : 0) + (changeExec ? PERMS.OTHER_EXEC : 0);\n          } // Sticky bit is special - it's not tied to user, group or other.\n\n\n          if (changeSticky) {\n            mask |= PERMS.STICKY;\n          }\n\n          switch (operator) {\n            case '+':\n              newPerms |= mask;\n              break;\n\n            case '-':\n              newPerms &= ~mask;\n              break;\n\n            case '=':\n              newPerms = type + mask; // According to POSIX, when using = to explicitly set the\n              // permissions, setuid and setgid can never be cleared.\n\n              if (common.statFollowLinks(file).isDirectory()) {\n                newPerms |= PERMS.SETUID + PERMS.SETGID & perms;\n              }\n\n              break;\n\n            default:\n              common.error('Could not recognize operator: `' + operator + '`');\n          }\n\n          if (options.verbose) {\n            console.log(file + ' -> ' + newPerms.toString(8));\n          }\n\n          if (perms !== newPerms) {\n            if (!options.verbose && options.changes) {\n              console.log(file + ' -> ' + newPerms.toString(8));\n            }\n\n            fs.chmodSync(file, newPerms);\n            perms = newPerms; // for the next round of changes!\n          }\n        } else {\n          common.error('Invalid symbolic mode change: ' + symbolicMode);\n        }\n      });\n    } else {\n      // they gave us a full number\n      newPerms = type + parseInt(mode, 8); // POSIX rules are that setuid and setgid can only be added using numeric\n      // form, but not cleared.\n\n      if (common.statFollowLinks(file).isDirectory()) {\n        newPerms |= PERMS.SETUID + PERMS.SETGID & perms;\n      }\n\n      fs.chmodSync(file, newPerms);\n    }\n  });\n  return '';\n}\n\nmodule.exports = _chmod;","map":{"version":3,"sources":["/home/s41m0n/Documents/University/Turin/YearII/CrownLabs/frontend/node_modules/shelljs/src/chmod.js"],"names":["common","require","fs","path","PERMS","base","OTHER_EXEC","EXEC","OTHER_WRITE","WRITE","OTHER_READ","READ","GROUP_EXEC","GROUP_WRITE","GROUP_READ","OWNER_EXEC","OWNER_WRITE","OWNER_READ","STICKY","parseInt","SETGID","SETUID","TYPE_MASK","register","_chmod","options","mode","filePattern","length","charAt","unshift","call","arguments","error","parseOptions","slice","files","recursive","forEach","addFile","expandedFile","stat","statNoFollowLinks","isSymbolicLink","push","isDirectory","readdirSync","child","innerChmod","file","resolve","existsSync","statFollowLinks","isDir","perms","type","newPerms","isNaN","split","symbolicMode","pattern","matches","exec","applyTo","operator","change","changeOwner","indexOf","changeGroup","changeOther","changeRead","changeWrite","changeExec","changeExecDir","changeSticky","changeSetuid","mask","verbose","console","log","toString","changes","chmodSync","module","exports"],"mappings":"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","sourcesContent":["var common = require('./common');\nvar fs = require('fs');\nvar path = require('path');\n\nvar PERMS = (function (base) {\n  return {\n    OTHER_EXEC: base.EXEC,\n    OTHER_WRITE: base.WRITE,\n    OTHER_READ: base.READ,\n\n    GROUP_EXEC: base.EXEC << 3,\n    GROUP_WRITE: base.WRITE << 3,\n    GROUP_READ: base.READ << 3,\n\n    OWNER_EXEC: base.EXEC << 6,\n    OWNER_WRITE: base.WRITE << 6,\n    OWNER_READ: base.READ << 6,\n\n    // Literal octal numbers are apparently not allowed in \"strict\" javascript.\n    STICKY: parseInt('01000', 8),\n    SETGID: parseInt('02000', 8),\n    SETUID: parseInt('04000', 8),\n\n    TYPE_MASK: parseInt('0770000', 8),\n  };\n}({\n  EXEC: 1,\n  WRITE: 2,\n  READ: 4,\n}));\n\ncommon.register('chmod', _chmod, {\n});\n\n//@\n//@ ### chmod([options,] octal_mode || octal_string, file)\n//@ ### chmod([options,] symbolic_mode, file)\n//@\n//@ Available options:\n//@\n//@ + `-v`: output a diagnostic for every file processed//@\n//@ + `-c`: like verbose, but report only when a change is made//@\n//@ + `-R`: change files and directories recursively//@\n//@\n//@ Examples:\n//@\n//@ ```javascript\n//@ chmod(755, '/Users/brandon');\n//@ chmod('755', '/Users/brandon'); // same as above\n//@ chmod('u+x', '/Users/brandon');\n//@ chmod('-R', 'a-w', '/Users/brandon');\n//@ ```\n//@\n//@ Alters the permissions of a file or directory by either specifying the\n//@ absolute permissions in octal form or expressing the changes in symbols.\n//@ This command tries to mimic the POSIX behavior as much as possible.\n//@ Notable exceptions:\n//@\n//@ + In symbolic modes, `a-r` and `-r` are identical.  No consideration is\n//@   given to the `umask`.\n//@ + There is no \"quiet\" option, since default behavior is to run silent.\nfunction _chmod(options, mode, filePattern) {\n  if (!filePattern) {\n    if (options.length > 0 && options.charAt(0) === '-') {\n      // Special case where the specified file permissions started with - to subtract perms, which\n      // get picked up by the option parser as command flags.\n      // If we are down by one argument and options starts with -, shift everything over.\n      [].unshift.call(arguments, '');\n    } else {\n      common.error('You must specify a file.');\n    }\n  }\n\n  options = common.parseOptions(options, {\n    'R': 'recursive',\n    'c': 'changes',\n    'v': 'verbose',\n  });\n\n  filePattern = [].slice.call(arguments, 2);\n\n  var files;\n\n  // TODO: replace this with a call to common.expand()\n  if (options.recursive) {\n    files = [];\n    filePattern.forEach(function addFile(expandedFile) {\n      var stat = common.statNoFollowLinks(expandedFile);\n\n      if (!stat.isSymbolicLink()) {\n        files.push(expandedFile);\n\n        if (stat.isDirectory()) {  // intentionally does not follow symlinks.\n          fs.readdirSync(expandedFile).forEach(function (child) {\n            addFile(expandedFile + '/' + child);\n          });\n        }\n      }\n    });\n  } else {\n    files = filePattern;\n  }\n\n  files.forEach(function innerChmod(file) {\n    file = path.resolve(file);\n    if (!fs.existsSync(file)) {\n      common.error('File not found: ' + file);\n    }\n\n    // When recursing, don't follow symlinks.\n    if (options.recursive && common.statNoFollowLinks(file).isSymbolicLink()) {\n      return;\n    }\n\n    var stat = common.statFollowLinks(file);\n    var isDir = stat.isDirectory();\n    var perms = stat.mode;\n    var type = perms & PERMS.TYPE_MASK;\n\n    var newPerms = perms;\n\n    if (isNaN(parseInt(mode, 8))) {\n      // parse options\n      mode.split(',').forEach(function (symbolicMode) {\n        var pattern = /([ugoa]*)([=\\+-])([rwxXst]*)/i;\n        var matches = pattern.exec(symbolicMode);\n\n        if (matches) {\n          var applyTo = matches[1];\n          var operator = matches[2];\n          var change = matches[3];\n\n          var changeOwner = applyTo.indexOf('u') !== -1 || applyTo === 'a' || applyTo === '';\n          var changeGroup = applyTo.indexOf('g') !== -1 || applyTo === 'a' || applyTo === '';\n          var changeOther = applyTo.indexOf('o') !== -1 || applyTo === 'a' || applyTo === '';\n\n          var changeRead = change.indexOf('r') !== -1;\n          var changeWrite = change.indexOf('w') !== -1;\n          var changeExec = change.indexOf('x') !== -1;\n          var changeExecDir = change.indexOf('X') !== -1;\n          var changeSticky = change.indexOf('t') !== -1;\n          var changeSetuid = change.indexOf('s') !== -1;\n\n          if (changeExecDir && isDir) {\n            changeExec = true;\n          }\n\n          var mask = 0;\n          if (changeOwner) {\n            mask |= (changeRead ? PERMS.OWNER_READ : 0) + (changeWrite ? PERMS.OWNER_WRITE : 0) + (changeExec ? PERMS.OWNER_EXEC : 0) + (changeSetuid ? PERMS.SETUID : 0);\n          }\n          if (changeGroup) {\n            mask |= (changeRead ? PERMS.GROUP_READ : 0) + (changeWrite ? PERMS.GROUP_WRITE : 0) + (changeExec ? PERMS.GROUP_EXEC : 0) + (changeSetuid ? PERMS.SETGID : 0);\n          }\n          if (changeOther) {\n            mask |= (changeRead ? PERMS.OTHER_READ : 0) + (changeWrite ? PERMS.OTHER_WRITE : 0) + (changeExec ? PERMS.OTHER_EXEC : 0);\n          }\n\n          // Sticky bit is special - it's not tied to user, group or other.\n          if (changeSticky) {\n            mask |= PERMS.STICKY;\n          }\n\n          switch (operator) {\n            case '+':\n              newPerms |= mask;\n              break;\n\n            case '-':\n              newPerms &= ~mask;\n              break;\n\n            case '=':\n              newPerms = type + mask;\n\n              // According to POSIX, when using = to explicitly set the\n              // permissions, setuid and setgid can never be cleared.\n              if (common.statFollowLinks(file).isDirectory()) {\n                newPerms |= (PERMS.SETUID + PERMS.SETGID) & perms;\n              }\n              break;\n            default:\n              common.error('Could not recognize operator: `' + operator + '`');\n          }\n\n          if (options.verbose) {\n            console.log(file + ' -> ' + newPerms.toString(8));\n          }\n\n          if (perms !== newPerms) {\n            if (!options.verbose && options.changes) {\n              console.log(file + ' -> ' + newPerms.toString(8));\n            }\n            fs.chmodSync(file, newPerms);\n            perms = newPerms; // for the next round of changes!\n          }\n        } else {\n          common.error('Invalid symbolic mode change: ' + symbolicMode);\n        }\n      });\n    } else {\n      // they gave us a full number\n      newPerms = type + parseInt(mode, 8);\n\n      // POSIX rules are that setuid and setgid can only be added using numeric\n      // form, but not cleared.\n      if (common.statFollowLinks(file).isDirectory()) {\n        newPerms |= (PERMS.SETUID + PERMS.SETGID) & perms;\n      }\n\n      fs.chmodSync(file, newPerms);\n    }\n  });\n  return '';\n}\nmodule.exports = _chmod;\n"]},"metadata":{},"sourceType":"script"}